import{r as y,M as P}from"./index-86cc0c1b.js";var D=Object.defineProperty,S=(t,e,a)=>e in t?D(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,N=(t,e,a)=>(S(t,typeof e!="symbol"?e+"":e,a),a),T={exports:{}},p={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _;function Y(){if(_)return p;_=1;var t=P,e=Symbol.for("react.element"),a=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,n=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,g={key:!0,ref:!0,__self:!0,__source:!0};function f(c,r,b){var l,h={},o=null,u=null;b!==void 0&&(o=""+b),r.key!==void 0&&(o=""+r.key),r.ref!==void 0&&(u=r.ref);for(l in r)s.call(r,l)&&!g.hasOwnProperty(l)&&(h[l]=r[l]);if(c&&c.defaultProps)for(l in r=c.defaultProps,r)h[l]===void 0&&(h[l]=r[l]);return{$$typeof:e,type:c,key:o,ref:u,props:h,_owner:n.current}}return p.Fragment=a,p.jsx=f,p.jsxs=f,p}T.exports=Y();var i=T.exports;class F{constructor(){N(this,"cache",{}),N(this,"CACHE_DURATION",24*60*60*1e3)}getCacheKey(e,a){return`${e}_${a}`}getCachedImage(e,a){const s=this.getCacheKey(e,a),n=this.cache[s];return n?Date.now()>n.expiresAt?(this.removeCachedImage(e,a),null):n.url:null}setCachedImage(e,a,s){const n=this.getCacheKey(e,a);this.cache[n]={url:s,timestamp:Date.now(),expiresAt:Date.now()+this.CACHE_DURATION}}removeCachedImage(e,a){const s=this.getCacheKey(e,a),n=this.cache[s];n&&(URL.revokeObjectURL(n.url),delete this.cache[s])}clearCache(){Object.values(this.cache).forEach(e=>{URL.revokeObjectURL(e.url)}),this.cache={}}cleanupExpired(){const e=Date.now();Object.keys(this.cache).forEach(a=>{this.cache[a].expiresAt<e&&(URL.revokeObjectURL(this.cache[a].url),delete this.cache[a])})}}const I=new F,H=t=>{if(!/^\d{4}-\d{2}-\d{2}$/.test(t))return!1;const e=new Date(t);return e instanceof Date&&!isNaN(e.getTime())},K=(t,e)=>{const a=t.replace(/\/$/,"");return a.includes("/daily-sheet")?`${a}/${e}`:`${a}/api/calendar/daily-sheet/${e}`},W=t=>{if(t.name==="TypeError"&&t.message.includes("fetch"))return"Network error: Unable to connect to the calendar service. Please check your internet connection.";if(t.status)switch(t.status){case 401:return"Authentication failed: Invalid API key or token. Please contact support for a valid API URL.";case 403:return"Access denied: Your API key does not have permission to access this resource.";case 404:return"Calendar not found: No calendar available for the selected date.";case 429:return"Rate limit exceeded: Too many requests. Please try again later.";case 500:return"Server error: The calendar service is temporarily unavailable. Please try again later.";default:return`Error ${t.status}: Unable to load calendar. Please try again.`}return"Unable to load Tamil calendar. Please check your API URL and try again."},B=({apiUrl:t,date:e,width:a=400,height:s,alt:n="Tamil Daily Calendar",className:g="",style:f={},onLoad:c,onError:r,showLoader:b=!0,loaderComponent:l,errorComponent:h})=>{const[o,u]=y.useState(null),[$,C]=y.useState(!1),[j,d]=y.useState(null),L=y.useCallback(async(m,R)=>{try{C(!0),d(null);const w=I.getCachedImage(m,R);if(w){u(w),C(!1),c==null||c();return}const x=K(m,R),v=await fetch(x,{method:"GET",headers:{Accept:"image/jpeg, image/png, image/*"}});if(!v.ok){const k=new Error(`HTTP ${v.status}: ${v.statusText}`);throw k.status=v.status,k}const U=await v.blob();if(!U.type.startsWith("image/"))throw new Error("Invalid response: Expected image data");const O=URL.createObjectURL(U);I.setCachedImage(m,R,O),u(O),c==null||c()}catch(w){const x=W(w);d(x),r==null||r(new Error(x))}finally{C(!1)}},[c,r]);y.useEffect(()=>{if(!t){d("API URL is required");return}if(!e){d("Date is required");return}if(!H(e)){d("Invalid date format. Please use YYYY-MM-DD format");return}return u(null),d(null),L(t,e),()=>{o&&URL.revokeObjectURL(o)}},[t,e,L]),y.useEffect(()=>()=>{o&&URL.revokeObjectURL(o)},[o]);const E={width:a,height:s||"auto",...f},A={width:"100%",height:s?"100%":"auto",objectFit:s?"contain":"initial",display:"block"};return $&&b?i.jsx("div",{className:`tamil-calendar-widget tamil-calendar-loading ${g}`,style:E,children:l||i.jsxs("div",{className:"tamil-calendar-loader",children:[i.jsx("div",{className:"tamil-calendar-spinner"}),i.jsx("p",{children:"Loading Tamil Calendar..."})]})}):j?i.jsx("div",{className:`tamil-calendar-widget tamil-calendar-error ${g}`,style:E,children:h||i.jsxs("div",{className:"tamil-calendar-error-content",children:[i.jsx("div",{className:"tamil-calendar-error-icon",children:"⚠️"}),i.jsx("p",{className:"tamil-calendar-error-message",children:j})]})}):o?i.jsx("div",{className:`tamil-calendar-widget ${g}`,style:E,children:i.jsx("img",{src:o,alt:n,style:A,onLoad:()=>c==null?void 0:c(),onError:()=>{const m="Failed to display calendar image";d(m),r==null||r(new Error(m))}})}):null};export{B as TamilCalendarWidget,I as imageCache};
